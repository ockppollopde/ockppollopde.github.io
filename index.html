<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>메이지 DPS 계산 & 무기/잠재 추천</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;max-width:1080px;margin:24px auto;padding:0 16px;line-height:1.5}
  h1{font-size:22px;margin:0 0 12px}
  h2{font-size:18px;margin:18px 0 8px}
  fieldset{border:1px solid #E5E7EB;border-radius:14px;padding:14px 14px 2px;margin:14px 0}
  legend{padding:0 8px;color:#374151}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1 1 220px;min-width:220px}
  label{display:block;margin:8px 0 4px;color:#374151}
  input[type="number"],select{width:100%;padding:9px;border:1px solid #D1D5DB;border-radius:10px}
  .btn{background:#111;color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer;margin-top:10px}
  .note{font-size:12px;color:#6B7280}
  .pill{display:inline-block;background:#F3F4F6;border-radius:999px;padding:4px 10px;margin:3px 6px 0 0;font-size:12px}
  .table{width:100%;border-collapse:collapse;margin:10px 0}
  .table th,.table td{border-bottom:1px solid #F1F5F9;padding:8px;text-align:right}
  .table th:first-child,.table td:first-child{text-align:left}
  .tip{background:#F7FBFF;border:1px solid #E5F0FF;padding:10px;border-radius:10px}
  .ok{color:#0a7a29}.warn{color:#9a5a00}
</style>
</head>
<body>
<h1>메이지 전용 DPS 계산 · 무기 & 잠재 추천</h1>
<p class="note">입력 → <b>계산하기</b>를 누르면 총 배율·평균 DPS와 함께 <b>잠재 옵션 추천</b>이 표시됩니다.</p>

<form id="form">
  <!-- 1) 기본 & 장신구 스탯 -->
  <fieldset>
    <legend>1) 기본 & 스탯</legend>
    <div class="row">
      <div class="col">
        <label>내 레벨</label>
        <input type="number" id="level" value="80" min="1" max="200"/>
      </div>
      <div class="col">
        <label>전투 타입</label>
        <select id="content">
          <option value="raid" selected>레이드(보스전) — 추가 대미지 +25%</option>
          <option value="field">일반 몬스터</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>데미지 스탯 포인트</label>
        <input type="number" id="accDmg" value="0" min="0"/>
        <div class="note">길드 버프 +5 자동 가산</div>
      </div>
      <div class="col">
        <label>이동속도 스탯 포인트</label>
        <input type="number" id="accSpd" value="0" min="0"/>
        <div class="note">1pt = 이동속도 +3.5% (표시용)</div>
      </div>
      <div class="col">
        <label>최대 체력 스탯 포인트</label>
        <input type="number" id="accHp" value="0" min="0"/>
        <div class="note">1pt = +25 HP &amp; 데미지 +0.4%, 길드 버프 +5 자동 가산</div>
      </div>
    </div>
    <div class="tip">길드 버프: <span class="pill">데미지 +5pt</span><span class="pill">체력 +5pt</span></div>
  </fieldset>

  <!-- 3) 디바인 샤드 -->
  <fieldset>
    <legend>3) 디바인 샤드</legend>
    <div class="row">
      <div class="col">
        <label>디바인 샤드 레벨 (0~15)</label>
        <input type="number" id="divineLevel" value="5" min="0" max="15"/>
        <div class="note">참고: LV×10 포인트 보유</div>
      </div>
      <div class="col">
        <label>디바인 <b>최종 데미지</b> 스탯 레벨 (0~15)</label>
        <input type="number" id="divineFD" value="8" min="0" max="15"/>
        <div class="note">LV.1당 +1% / <b>스파이크 구간</b> 이후는 LV당 +2%</div>
      </div>
      <div class="col">
        <label>스파이크 시작 레벨 (증가폭 2배 시작)</label>
        <input type="number" id="spikeLv" value="9" min="1" max="15"/>
        <div class="note">예: 9로 두면 1~8:+1% / 9~15:+2%</div>
      </div>
    </div>
  </fieldset>

  <!-- 4) 직업 & 스킬 -->
  <fieldset>
    <legend>4) 직업: 메이지 (고정)</legend>
    <div class="pill">평타 DPS: <b>373</b></div>
    <div class="row">
      <div class="col">
        <label>직업무기 A 사용 (2636 / 14s)</label>
        <select id="classA"><option value="on" selected>사용</option><option value="off">미사용</option></select>
      </div>
      <div class="col">
        <label>직업무기 B 사용 (5712 / 18s)</label>
        <select id="classB"><option value="on" selected>사용</option><option value="off">미사용</option></select>
      </div>
    </div>
  </fieldset>

  <!-- 5) 운명무기 -->
  <fieldset>
    <legend>5) 운명무기 (보유 체크)</legend>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="fate" value="olympus" checked/> 올림푸스</label><div class="note">A:1945×2/19s, B:5538/42s</div></div>
      <div class="col"><label><input type="checkbox" class="fate" value="valhalla"/> 발할라</label><div class="note">A:1433×2/14s, B:2450×2/35s</div></div>
      <div class="col"><label><input type="checkbox" disabled/> 골드문(힐템)</label></div>
    </div>
  </fieldset>

  <!-- 7) 특수무기 -->
  <fieldset>
    <legend>7) 특수무기 (보유 체크)</legend>
    <h4 class="note" style="margin:6px 0 0">필멸</h4>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레탄12"/> 플레탄 +12 (7001/32)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레탄13"/> 플레탄 +13 (7809/29)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레탄14"/> 플레탄 +14 (9424/29)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레탄15"/> 플레탄 +15 (11848/29)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="아케론12"/> 아케론 +12 (1076×7/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="아케론13"/> 아케론 +13 (1200×7/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="아케론14"/> 아케론 +14 (1510×7/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="아케론15"/> 아케론 +15 (1897×7/22)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레게톤12"/> 플레게톤 +12 (538×20/37)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레게톤13"/> 플레게톤 +13 (600×20/37)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레게톤14"/> 플레게톤 +14 (755×20/37)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="mortal" value="플레게톤15"/> 플레게톤 +15 (949×20/37)</label></div>
    </div>

    <h4 class="note" style="margin:10px 0 0">전설</h4>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="스톰레온12"/> 스톰레온 +12 (5891/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="스톰레온13"/> 스톰레온 +13 (6571/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="스톰레온14"/> 스톰레온 +14 (8236/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="스톰레온15"/> 스톰레온 +15 (10353/22)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="아르테온12"/> 아르테온 +12 (2493×3/26)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="아르테온13"/> 아르테온 +13 (2785×3/26)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="아르테온14"/> 아르테온 +14 (3500×3/26)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="아르테온15"/> 아르테온 +15 (4401×3/26)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="카이엔12"/> 카이엔 +12 (655×16/36)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="카이엔13"/> 카이엔 +13 (731×16/36)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="카이엔14"/> 카이엔 +14 (919×16/36)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="카이엔15"/> 카이엔 +15 (1155×16/36)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="하켄12"/> 하켄 +12 (7014/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="하켄13"/> 하켄 +13 (7823/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="하켄14"/> 하켄 +14 (9804/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="하켄15"/> 하켄 +15 (12326/22)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="이그니스12"/> 이그니스 +12 (780×9/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="이그니스13"/> 이그니스 +13 (869×9/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="이그니스14"/> 이그니스 +14 (1093×9/22)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="이그니스15"/> 이그니스 +15 (1374×9/22)</label></div>
    </div>
    <div class="row">
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="드래고니아12"/> 드래고니아 +12 (9089/30)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="드래고니아13"/> 드래고니아 +13 (10138/30)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="드래고니아14"/> 드래고니아 +14 (12745/30)</label></div>
      <div class="col"><label><input type="checkbox" class="spec" data-grade="legend" value="드래고니아15"/> 드래고니아 +15 (16023/30)</label></div>
    </div>
  </fieldset>

  <button type="button" class="btn" id="calcBtn">계산하기</button>
</form>

<div id="out"></div>

<script>
/* ===== 고정 데이터 ===== */
const BASE_AUTO_DPS = 373;               // 평타
const RAID_BONUS = 0.25;                 // 레이드 추가 대미지
const classSkills = { A:{dmg:2636,cd:14}, B:{dmg:5712,cd:18} };
const fateWeapons = {
  olympus:{A:{dmg:1945*2,cd:19},B:{dmg:5538,cd:42},name:"올림푸스"},
  valhalla:{A:{dmg:1433*2,cd:14},B:{dmg:2450*2,cd:35},name:"발할라"}
};
const specWeapons = {
  "플레탄12":{dmg:7001,cd:32,grade:"mortal",name:"플레탄 +12"},
  "플레탄13":{dmg:7809,cd:29,grade:"mortal",name:"플레탄 +13"},
  "플레탄14":{dmg:9424,cd:29,grade:"mortal",name:"플레탄 +14"},
  "플레탄15":{dmg:11848,cd:29,grade:"mortal",name:"플레탄 +15"},
  "아케론12":{dmg:1076*7,cd:22,grade:"mortal",name:"아케론 +12"},
  "아케론13":{dmg:1200*7,cd:22,grade:"mortal",name:"아케론 +13"},
  "아케론14":{dmg:1510*7,cd:22,grade:"mortal",name:"아케론 +14"},
  "아케론15":{dmg:1897*7,cd:22,grade:"mortal",name:"아케론 +15"},
  "플레게톤12":{dmg:538*20,cd:37,grade:"mortal",name:"플레게톤 +12"},
  "플레게톤13":{dmg:600*20,cd:37,grade:"mortal",name:"플레게톤 +13"},
  "플레게톤14":{dmg:755*20,cd:37,grade:"mortal",name:"플레게톤 +14"},
  "플레게톤15":{dmg:949*20,cd:37,grade:"mortal",name:"플레게톤 +15"},
  "스톰레온12":{dmg:5891,cd:22,grade:"legend",name:"스톰레온 +12"},
  "스톰레온13":{dmg:6571,cd:22,grade:"legend",name:"스톰레온 +13"},
  "스톰레온14":{dmg:8236,cd:22,grade:"legend",name:"스톰레온 +14"},
  "스톰레온15":{dmg:10353,cd:22,grade:"legend",name:"스톰레온 +15"},
  "아르테온12":{dmg:2493*3,cd:26,grade:"legend",name:"아르테온 +12"},
  "아르테온13":{dmg:2785*3,cd:26,grade:"legend",name:"아르테온 +13"},
  "아르테온14":{dmg:3500*3,cd:26,grade:"legend",name:"아르테온 +14"},
  "아르테온15":{dmg:4401*3,cd:26,grade:"legend",name:"아르테온 +15"},
  "카이엔12":{dmg:655*16,cd:36,grade:"legend",name:"카이엔 +12"},
  "카이엔13":{dmg:731*16,cd:36,grade:"legend",name:"카이엔 +13"},
  "카이엔14":{dmg:919*16,cd:36,grade:"legend",name:"카이엔 +14"},
  "카이엔15":{dmg:1155*16,cd:36,grade:"legend",name:"카이엔 +15"},
  "하켄12":{dmg:7014,cd:22,grade:"legend",name:"하켄 +12"},
  "하켄13":{dmg:7823,cd:22,grade:"legend",name:"하켄 +13"},
  "하켄14":{dmg:9804,cd:22,grade:"legend",name:"하켄 +14"},
  "하켄15":{dmg:12326,cd:22,grade:"legend",name:"하켄 +15"},
  "이그니스12":{dmg:780*9,cd:22,grade:"legend",name:"이그니스 +12"},
  "이그니스13":{dmg:869*9,cd:22,grade:"legend",name:"이그니스 +13"},
  "이그니스14":{dmg:1093*9,cd:22,grade:"legend",name:"이그니스 +14"},
  "이그니스15":{dmg:1374*9,cd:22,grade:"legend",name:"이그니스 +15"},
  "드래고니아12":{dmg:9089,cd:30,grade:"legend",name:"드래고니아 +12"},
  "드래고니아13":{dmg:10138,cd:30,grade:"legend",name:"드래고니아 +13"},
  "드래고니아14":{dmg:12745,cd:30,grade:"legend",name:"드래고니아 +14"},
  "드래고니아15":{dmg:16023,cd:30,grade:"legend",name:"드래고니아 +15"}
};

// (이미지 표 기반) 잠재 옵션: 등급별 수치(일반/고급/희귀/영웅)
const POT = {
  "보스 대상 데미지 증가":          { scope:"boss", type:"mult", v:{N:2.25,G:4.50,R:6.75,E:9.00} },
  "일반 몬스터 대상 데미지 증가":   { scope:"normal", type:"mult", v:{N:3.00,G:6.00,R:9.00,E:12.00} },
  "스킬 쿨타임 감소":               { scope:"allSkill", type:"cdr",  v:{N:3.00,G:6.00,R:9.00,E:12.00} },
  "클래스 기본 공격 데미지 증가":   { scope:"auto", type:"mult",     v:{N:13.75,G:25.00,R:36.25,E:47.50} },
  "클래스 스킬 데미지 증가":        { scope:"classSkill", type:"mult", v:{N:3.00,G:6.00,R:9.00,E:12.00} },
  "특수 무기 데미지 증가":          { scope:"specAll", type:"mult",  v:{N:1.50,G:3.00,R:4.50,E:6.00} },
  "전설 등급 무기 데미지 증가":     { scope:"legend",  type:"mult",  v:{N:3.00,G:6.00,R:9.00,E:12.00} },
  "전설&전용 등급 무기 데미지 증가":{ scope:"legend",  type:"mult",  v:{N:2.25,G:4.50,R:6.75,E:9.00} },
  "영웅 등급 무기 데미지 증가":     { scope:"hero",    type:"mult",  v:{N:3.00,G:6.00,R:9.00,E:12.00} },
  "희귀 등급 무기 데미지 증가":     { scope:"rare",    type:"mult",  v:{N:4.50,G:9.00,R:13.5,E:18.00} },
  "일반&고급 등급 무기 데미지 증가":{ scope:"low",     type:"mult",  v:{N:2.25,G:4.50,R:6.75,E:9.00} }
};
// 이 예시에선 무기 등급을 "legend(전설)" 또는 "mortal(필멸)"만 사용하므로 hero/rare/low는 표시용

const pct=(x)=> (x*100).toFixed(2)+"%";
const f2=(x)=> x.toFixed(2);

/* ===== 계산 ===== */
function calc(){
  const content = document.getElementById('content').value; // raid | field
  const raidMul = (content==="raid") ? (1+RAID_BONUS) : 1;

  // 스탯
  const accDmg = Number(document.getElementById('accDmg').value)+5; // 길드 +5
  const accSpd = Number(document.getElementById('accSpd').value);
  const accHp  = Number(document.getElementById('accHp').value)+5; // 길드 +5

  const dmgFromDmg = accDmg*0.0065;
  const dmgFromHp  = accHp*0.0040;
  const msFromSpd  = accSpd*3.5;     // 표기용
  const hpFlat     = accHp*25;       // 표기용

  // 디바인 최종 데미지 (스파이크)
  const divineFD = Math.max(0, Math.min(15, Number(document.getElementById('divineFD').value)));
  const spikeLv  = Math.max(1, Math.min(15, Number(document.getElementById('spikeLv').value)));
  const pre = Math.min(divineFD, spikeLv-1) * 0.01;      // 스파이크 전: +1%/LV
  const post = Math.max(0, divineFD-(spikeLv-1)) * 0.02; // 스파이크 이후: +2%/LV
  const divineMul = pre + post;

  const totalInc = dmgFromDmg + dmgFromHp + divineMul;
  const totalMul = raidMul * (1 + totalInc);

  // 구성 DPS
  let autoDps = BASE_AUTO_DPS * totalMul;

  let comp = []; // [name, rawDmg, cd, dps]
  const useA = document.getElementById('classA').value==="on";
  const useB = document.getElementById('classB').value==="on";
  if(useA){ comp.push(["직업무기 A", classSkills.A.dmg, classSkills.A.cd, (classSkills.A.dmg/classSkills.A.cd)*totalMul, "classSkill"]); }
  if(useB){ comp.push(["직업무기 B", classSkills.B.dmg, classSkills.B.cd, (classSkills.B.dmg/classSkills.B.cd)*totalMul, "classSkill"]); }

  // 운명무기
  const ownedFate=[...document.querySelectorAll('.fate:checked')].map(x=>x.value);
  ownedFate.forEach(k=>{
    const fw=fateWeapons[k];
    comp.push([`${fw.name} A`, fw.A.dmg, fw.A.cd, (fw.A.dmg/fw.A.cd)*totalMul, "skill"]);
    comp.push([`${fw.name} B`, fw.B.dmg, fw.B.cd, (fw.B.dmg/fw.B.cd)*totalMul, "skill"]);
  });

  // 특수무기
  const ownedSpec=[...document.querySelectorAll('.spec:checked')].map(x=>x.value);
  const specGradeMap={};
  ownedSpec.forEach(key=>{
    const w=specWeapons[key];
    comp.push([w.name, w.dmg, w.cd, (w.dmg/w.cd)*totalMul, w.grade]); // grade: legend|mortal
    specGradeMap[w.grade]=(specGradeMap[w.grade]||0)+ (w.dmg/w.cd)*totalMul;
  });

  // 총합 DPS
  const skillsDps = comp.reduce((s,x)=>s+x[3],0);
  const totalDps  = autoDps + skillsDps;

  // ===== 잠재 옵션 추천: 각 옵션을 적용했을 때의 DPS 증가율 추정 =====
  function evalPotential(name, tier){ // tier: N/G/R/E
    const p = POT[name];
    const val = p.v[tier]/100; // % → 배율

    if(p.type==="mult"){
      // 적용 범위별 분모(현재 기여) 산정
      let affected = 0;
      if(p.scope==="boss"   && content==="raid")   affected = totalDps;
      else if(p.scope==="normal" && content!=="raid") affected = totalDps;
      else if(p.scope==="auto") affected = autoDps;
      else if(p.scope==="classSkill"){
        affected = comp.filter(x=>x[4]==="classSkill").reduce((s,x)=>s+x[3],0);
      }
      else if(p.scope==="specAll"){
        affected = comp.filter(x=>x[4]==="legend"||x[4]==="mortal").reduce((s,x)=>s+x[3],0);
      }
      else if(p.scope==="legend"){
        affected = comp.filter(x=>x[4]==="legend").reduce((s,x)=>s+x[3],0);
      }
      else if(p.scope==="hero"||p.scope==="rare"||p.scope==="low"){
        // 표시만 – 현재 데이터셋에 직접 매칭되는 무기 등급이 없어 0으로 평가
        affected = 0;
      } else {
        affected = totalDps; // all 등 기타
      }
      const gain = affected * val;
      return { name, tier, kind:"가산 배율", affected, gain, rel: affected? (gain/totalDps):0 };
    } else if(p.type==="cdr"){
      // 쿨감: 쿨다운이 있는 모든 스킬에 1/(1 - val) 배율 적용 가정
      const skillOnly = comp.reduce((s,x)=>s+x[3],0);
      const gain = skillOnly * ( (1/(1-val)) - 1 );
      return { name, tier, kind:"쿨감", affected:skillOnly, gain, rel:gain/totalDps };
    }
    return { name, tier, kind:"기타", affected:0, gain:0, rel:0 };
  }

  const candidates=[];
  for(const name of Object.keys(POT)){
    for(const tier of ["N","G","R","E"]){
      candidates.push( evalPotential(name, tier) );
    }
  }
  // 기여율 순 정렬
  candidates.sort((a,b)=> b.rel - a.rel);
  const top = candidates.slice(0,5);

  // 상세 표
  const rows = [...comp].sort((a,b)=>b[3]-a[3]).map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${f2(r[3])}</td></tr>`).join("");

  // 추천 사유 텍스트
  const statAdvice = (0.0065 > 0.0040)
    ? "장신구 포인트는 '데미지'가 체력(+0.4%)보다 DPS 상승폭이 큽니다. (1pt당 +0.65%)"
    : "체력도 DPS에 기여하지만, 데미지 포인트 대비 효율이 낮습니다.";
  const spikeTxt = `디바인 최종 데미지 LV ${divineFD} (스파이크 ${spikeLv} 시작) → 배율 기여 ${pct(divineMul)}`;

  // 출력
  const out = document.getElementById('out');
  out.innerHTML = `
    <h2>결과 요약</h2>
    <div>
      <span class="pill">총 데미지 배율: <b>${pct(totalMul-1)}</b></span>
      <span class="pill">이동속도: <b>${pct(msFromSpd/100)}</b></
